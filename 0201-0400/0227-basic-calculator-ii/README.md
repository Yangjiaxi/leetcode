# [C++] LL(1) é€’å½’ä¸‹é™è¡¨è¾¾å¼æ±‚å€¼ï¼Œå«æ‹¬å·ã€è´Ÿæ•°

ä¸Šå­¦æœŸå¼€äº†**ç¼–è¯‘åŸç†**è¿™é—¨è¯¾ï¼Œä»Šå¤©å€Ÿè¿™é“é¢˜è·Ÿå¤§å®¶åˆ†äº«ä¸€ä¸‹ `LL(1)` é€’å½’ä¸‹é™è§£æå™¨çš„åŸç†ã€‚ğŸ¤”

TL;DRï¼šæƒ³çœ‹ä»£ç çš„å°ä¼™ä¼´ç›´æ¥å¾€ä¸‹æ‹‰å°±è¡Œ

## å®šä¹‰

å…ˆé˜è¿°ï¼ˆå£èƒ¡ï¼‰ä¸€å°æ®µå®šä¹‰ï¼š

`LL(k)` åˆ†æå™¨æ˜¯ä¸€ç§å¤„ç†æŸäº›ä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•çš„è‡ªé¡¶å‘ä¸‹åˆ†æå™¨ï¼Œå®ƒä»å·¦å‘å³è¯»å–è¾“å…¥ï¼Œä¸€è¾¹è¯»å–ä¸€éæ„å»ºæ¨å¯¼æ ‘ã€‚åå­—ä¸­çš„`k`æŒ‡çš„æ˜¯åœ¨æŸä¸ªå¥å‹çš„å‰æä¸‹ï¼Œå‘å‰çœ‹`k`ä¸ªå­—ç¬¦å°±å¯ä»¥ç¡®å®šç°åœ¨åº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªäº§ç”Ÿå¼ã€‚å› æ­¤ `LL(1)` æ„å‘³ç€å¯¹äºç»™å®šçš„äº§ç”Ÿå¼é›†åˆï¼Œæ¯æ¬¡åªéœ€è¦å‘å‰çœ‹ä¸€ä¸ªå­—ç¬¦ï¼Œå°±å¯ä»¥ç¡®å®šç›®å‰åº”è¯¥ä½¿ç”¨å“ªä¸ªäº§ç”Ÿå¼ã€‚

## äº§ç”Ÿå¼

é¦–å…ˆä»‹ç»æœ¬ä¾‹ä¸­çš„äº§ç”Ÿå¼ï¼ˆæ–‡æ³•ï¼‰ï¼ŒåŒ…å«æ‹¬å·å“¦

```
Expr ::=
    Term + Expr
    | Term - Expr
    | Term

Term ::=
    Factor * Term
    | Factor / Term
    | Factor

Factor ::=
    (Expr)
    | NUM
    | -NUM
```

äº§ç”Ÿå¼ä¸»è¦ç”±å·¦éƒ¨å’Œå³éƒ¨åˆ—è¡¨æ„æˆï¼Œå®ƒçš„è¯­ä¹‰æ˜¯**å·¦éƒ¨å¯ä»¥ç”±æŸç§å³éƒ¨æ„æˆ**

```
å·¦éƒ¨ ::=
    å³éƒ¨Ver.1
    | å³éƒ¨Ver.2
    ...
```

äº§ç”Ÿå¼ä¸­åŒ…æ‹¬ä¸¤ç§æˆåˆ†ï¼Œ**ç»ˆç»“ç¬¦**ä¸**éç»ˆç»“ç¬¦**

- ç»ˆç»“ç¬¦ä¸ºä¸å¯ä»¥ç»§ç»­æ¨å¯¼ä¸‹å»çš„æˆåˆ†ï¼Œä¾‹å¦‚æ•°å­—ã€æ‹¬å·ç­‰
- éç»ˆç»“ç¬¦å°±æ˜¯è¿˜æ²¡æ¨å¯¼åˆ°ä½çš„æˆåˆ†ï¼Œä¸ä¸¥æ ¼åœ°è¯´ï¼Œå°±æ˜¯äº§ç”Ÿå¼çš„å·¦éƒ¨

å¯¹äºæœ¬é¢˜æ¥è¯´ï¼Œéç»ˆç»“ç¬¦ä¸º`NUM`ï¼ˆæ•°å­—ï¼‰ä¸æ‹¬å·çš„å­—ç¬¦`(`, `)`ï¼Œè€Œ`Expr`ï¼Œ`Term`ï¼Œ`Factor`å‡ä¸ºéç»ˆç»“ç¬¦

åœ¨éç»ˆç»“ç¬¦ä¸­ï¼Œæœ‰ä¸€ä¸ªèº«ä»½ç‰¹æ®Šçš„è§’è‰²â€”â€”**æ–‡æ³•å¼€å§‹ç¬¦å·**ã€‚é¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ä¸€åˆ‡æ¨å¯¼çš„**èµ·ç‚¹**ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ`Expr`ä¾¿æ˜¯æ–‡æ³•å¼€å§‹ç¬¦å·

## æ¨å¯¼

ä¸¾ä¸ªğŸŒ°ï¼š

å¯¹äºå¼å­`Expr: 1 - 2 * 2`ï¼Œå¯ä»¥è¿™æ ·çœ‹å¾…

```
1 - 2 * 2, Expr
1 - 2 * 2, Term - Expr
1 - 2 * 2, Factor - Expr
1 - 2 * 2, NUM - Expr
1 - 2 * 2, NUM - Term
1 - 2 * 2, NUM - Factor * Term
1 - 2 * 2, NUM - NUM * Term
1 - 2 * 2, NUM - NUM * Factor
1 - 2 * 2, NUM - NUM * NUM
```

å¯¹äºæ¯ä¸€æ­¥ä¸­æ‰€æœ‰å¯ä»¥è¿›è¡Œæ¨å¯¼çš„é¡¹ï¼Œæˆ‘ä»¬æ€»æ˜¯é€‰æ‹©æœ€å·¦è¾¹çš„ä¸€é¡¹è¿›è¡Œå±•å¼€ï¼Œè¿™ä¸ªæ–¹æ³•å«åšæœ€å·¦æ¨å¯¼ï¼ŒåŒç†ï¼Œè¿˜æœ‰æœ€å³æ¨å¯¼ã€‚

## FIRSTé›†ä¸FOLLOWé›†

å…·ä½“çš„ä¸€å †ç†è®ºå°±ä¸è®²äº†ï¼Œç®€å•è¯´ä¸€ä¸‹å®ƒä»¬çš„å®šä¹‰

### FIRSTé›†

å¯¹äºä¸€ä¸ªæ–‡æ³•ç¬¦å·$\alpha$ï¼ˆç»ˆç»“ç¬¦æˆ–éç»ˆç»“ç¬¦éƒ½è¡Œï¼‰ï¼Œä»å®ƒå¼€å§‹æ¨å¯¼å¯ä»¥å¾—åˆ°ä¸€ç³»åˆ—ä¸²ï¼Œè¿™äº›ä¸²éƒ½æœ‰é¦–ç¬¦å·ï¼ˆç»ˆç»“ç¬¦ï¼‰ï¼Œè€ŒFIRSTé›†å°±æ˜¯è¿™äº›**é¦–ç¬¦å·**çš„é›†åˆ

### FOLLOWé›†

å¯¹äºä¸€ä¸ªéç»ˆç»“ç¬¦Aï¼Œåœ¨æ–‡æ³•çš„æŒ‡å¯¼ä¸‹ï¼ŒæŸäº›å¥å‹ä¸­Açš„åé¢å¯èƒ½ä¼š**ç´§è·Ÿ**ç€æŸäº›ç»ˆç»“ç¬¦ï¼Œè€Œè¿™äº›ç»ˆç»“ç¬¦çš„é›†åˆä¾¿æ˜¯FOLLOWé›†

å¦‚ä½•ä»ä¸€ä¸ªæ–‡æ³•æ¨å¯¼å‡ºè¿™ä¿©æˆ‘å°±ä¸å¤šè¯´äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥çœ‹çœ‹è¿™ä½è€å“¥çš„åšå®¢[https://www.jianshu.com/p/396c4bd0dd6b](https://www.jianshu.com/p/396c4bd0dd6b)

## æå–å·¦å…¬å› å­ï¼Œæ¶ˆé™¤å·¦é€’å½’

### æ¶ˆé™¤å·¦é€’å½’

ä¾‹å¦‚å¯¹äºäº§ç”Ÿå¼`A->Ab`ï¼Œå¦‚æœæˆ‘ä¸€ç›´å‘å·¦è¾¹æ·»åŠ è¿™ä¸ªäº§ç”Ÿå¼å°±ä¼šå¾—åˆ°

```
A->Ab->Abb->Abbb...
```

è¿™ç§å·¦é€’å½’ç°è±¡æ˜¯ä¸å¥½çš„ï¼Œå› ä¸ºæ— æ³•æ˜ç¡®çŸ¥é“éœ€è¦ä½¿ç”¨å“ªä¸ªäº§ç”Ÿå¼ï¼Œå› æ­¤éœ€è¦æ¶ˆé™¤å·¦é€’å½’

### å·¦å…¬å› å­æå–

æ¯”å¦‚è¯´æ–‡æ³•`A->xB | xC`ï¼Œå½“å¤„ç†åˆ°éç»ˆç»“ç¬¦`A`æ—¶ï¼Œå¦‚æœpeekåˆ°äº†å­—ç¬¦`x`ï¼Œä¾¿æ— æ³•ç¡®å®šä½¿ç”¨`A->xB`è¿˜æ˜¯`A->xC`ï¼Œè¿™ä¹Ÿæ˜¯ä¸å¥½çš„ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå·¦å…¬å› å­æå–

å…·ä½“è¿‡ç¨‹å°±ä¸åœ¨è¿™é‡Œæè¿°äº†ï¼Œæ€»ä¹‹æ¶ˆé™¤äº†å·¦é€’å½’åçš„äº§ç”Ÿå¼ä¸ºï¼š

æ³¨ï¼šå…¶ä¸­`eps`è¡¨ç¤ºç©ºï¼ˆè¡¨ç¤ºåœæ­¢è¯¥éç»ˆç»“ç¬¦çš„æ¨å¯¼ï¼‰ï¼Œ`->`ä¸`::=`æ„ä¹‰ç›¸åŒï¼ˆå¥½åƒæ˜¯ç®€å†™ï¼‰

```
Expr -> Term Expr'
Expr'-> +Term| -Term | eps

Term -> Factor Term'
Term'-> *Factor Term' | /Factor Term' | eps

Factor -> (Expr) | NUM | -NUM
```

## âœ¨é€’å½’ä¸‹é™ç¨‹åº

é€’å½’ä¸‹é™ç¨‹åºå…¶å®å°±æ˜¯æŠŠäº§ç”Ÿå¼ç¿»è¯‘æˆäº†ä¸€å †å°å‡½æ•°ï¼Œä»æ–‡æ³•å¼€å§‹ç¬¦çš„å‡½æ•°å¼€å§‹ä¸€ç›´å¤„ç†å®Œæ‰€æœ‰ç¬¦å·ï¼Œå¹¶åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œç›¸åº”æ“ä½œ

è¯´æ˜ï¼šå…¶å®æˆ‘è·³è¿‡äº†å¾ˆå¤šæ­¥ï¼Œä½¿ç”¨é€’å½’ä¸‹é™æ–¹æ³•å¿…é¡»è¯æ˜æ–‡æ³•æ˜¯æ»¡è¶³`LL(1)`çš„ï¼Œä¹Ÿå°±æ˜¯è¯æ˜åŒä¸€ä¸ªéç»ˆç»“ç¬¦çš„äº§ç”Ÿå¼æ²¡æœ‰ç›¸äº’å†²çªçš„`FIRST`é›†ï¼Œå…·ä½“æ–¹æ³•å¯ä»¥æŸ¥çœ‹æ–‡æœ«åˆ—å‡ºçš„ä¸€ç³»åˆ—èµ„æ–™ğŸ™

```cpp
#include <iostream>

using namespace std;

class Solution {
  private:
    char token;
    string buffer;
    int index;

    char peek() {
        // remove whitespaces
        while (buffer[index + 1] == ' ') ++index;
        return buffer[index + 1];
    }

    void consume() {
        ++index;
        token = buffer[index];
    }

    int expr() {
        // Expr -> Term Expr'
        int value = term();
        // Expr'-> +Term| -Term | eps
        while (1) {
            if (peek() == '+') {
                consume();
                value += term();
            } else if (peek() == '-') {
                consume();
                value -= term();
            } else {
                break;
            }
        }
        return value;
    }

    int term() {
        // Term -> Factor Term'
        int value = factor();
        // Term'-> *Factor Term' | /Factor Term' | eps
        while (1) {
            if (peek() == '*') {
                consume();
                value *= factor();
            } else if (peek() == '/') {
                consume();
                value /= factor();
            } else
                break;
        }
        return value;
    }

    // Factor -> (Expr) | NUM | -NUM
    int factor() {
        int sign = 1;
        if (peek() == '-') {
            consume();
            sign = -1;
        }

        int value;

        if (isdigit(peek())) {
            value = sign * number();
        } else if (peek() == '(') {
            consume(); // match (
            value = sign * expr();
            consume(); // match )
        }
        return value;
    }

    // NUM (unsigned)
    int number() {
        int value = 0;
        while (isdigit(peek())) {
            consume();
            value = value * 10 + (token - '0');
        }
        return value;
    }

  public:
    int calculate(const string &s) {
        buffer = s;
        index = -1;
        // entry
        return expr();
    }
};

int main() {
    Solution a;
    pair<string, int> test[] = {
        {"1 + -1", 0},
        {" -1 ", -1},
        {"1   + 1", 2},
        {"2 - 1 + 2", 3},
        {"(1+(4+5+2)-3)+(6+8)", 23},
        {"3+2 * 2", 7},
        {"((1 + (3 * 2 / 1) * 2) + 1) / (2 * 2 * 2 - 1)", 2}};
    for (auto &[s, t] : test) {
        cout << "`" << s << "`" << endl;
        cout << "Expected: " << t << ", Actual: " << a.calculate(s) << endl;
        cout << string(20, '-') << endl;
    }
    return 0;
}
```

## æ€»ç»“

æ€»ç»“ä¸€ä¸‹ï¼Œæœ¬æ–¹æ³•ä¸ä½¿ç”¨æ ˆçš„æ–¹æ³•çœ‹èµ·æ¥ç›¸å»ç”šè¿œï¼Œä½†äº‹å®ä¸Šå®Œå…¨ä¸€è‡´

ä»”ç»†è§‚å¯Ÿéç»ˆç»“ç¬¦å‡½æ•°ä¹‹é—´çš„è·³è½¬ï¼Œè¿™äº›è·³è½¬å°±æ˜¯æ ˆæ–¹æ³•ä¸­çš„å‹æ ˆã€‚äº‹å®ä¸Šé€’å½’ä¸‹é™ç®—æ³•çš„è¿è¡Œæ—¶é€’å½’æ ˆä¸ä¼ ç»Ÿçš„æ ˆæ–¹æ³•æ˜¯åŒæ„çš„

æ­¤å¤–ï¼Œäº§ç”Ÿå¼ä¹‹é—´çš„è”åŠ¨é¡ºåºä½“ç°çš„æ˜¯æ ˆæ–¹æ³•ä¸­å¯¹ä¼˜å…ˆçº§çš„é™åˆ¶ã€‚ä¾‹å¦‚æˆ‘ä»¬éƒ½çŸ¥é“ä¹˜é™¤å…ˆäºåŠ å‡ï¼Œåœ¨é€’å½’ä¸‹é™ç®—æ³•ä¸­å°±ä½“ç°åœ¨åŒ…å«åŠ å‡æ³•è¿ç®—çš„`Expr`å¯ä»¥è¢«åŒ…å«ä¹˜é™¤æ³•è¿ç®—çš„`Term`æ‰“ç ´ï¼Œè€Œ**æ‰“ç ´**äº‹å®ä¸Šå°±æ˜¯ä¼˜å…ˆçº§é«˜çš„è¡¨ç°ã€‚åŒç†ï¼ŒåŒ…å«æ‹¬å·çš„`Factor`å¯ä»¥æ‰“ç ´ä¹˜é™¤è¿ç®—`Term`

## å…¶ä»–

é€’å½’ä¸‹é™ç¨‹åºå†™èµ·æ¥èŠ‚ç‚¹çœ‹èµ·æ¥èˆ’æœï¼Œä½†é—®é¢˜å°±ååå‡ºåœ¨é€’å½’ä¸Šï¼Œå› ä¸ºä¼—æ‰€å‘¨çŸ¥ï¼Œé€’å½’å¼€é”€æå¤§

å› æ­¤äººä»¬åˆæƒ³å‡ºäº†ä¸€ç§ä¸ä½¿ç”¨é€’å½’ï¼Œç›´æ¥è¿›è¡Œåˆ†æçš„åŠæ³•â€”â€”**LL(1)åˆ†æè¡¨**

LL(1)åˆ†æè¡¨æ˜¯ä¸€å¼ äºŒç»´çš„è¡¨ï¼Œå®ƒè¡¨è¾¾äº†â€å½“ç¨‹åºå¤„äºä¸€ä¸ªéç»ˆç»“ç¬¦æ—¶ï¼Œå¦‚æœçœ‹åˆ°æŸä¸ªå­—ç¬¦ï¼Œåº”è¯¥é‡‡ç”¨å“ªä¸ªç”Ÿæˆå¼â€œï¼Œä½¿ç”¨åˆ†ææ ˆä¸ç¬¦å·æ ˆå³å¯å®Œæˆæ‰«æï¼Œå› æ­¤æ˜¯ä¸€ç§éé€’å½’çš„è‡ªé¡¶å‘ä¸‹åˆ†æå™¨

ç½—åˆ—å‡ ä¸ªåšå®¢ä¾›æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å‚è€ƒï¼š

- [[ç®€ä¹¦] ç¼–è¯‘åŸç†-æ±‚æ–‡æ³•Gçš„é¢„æµ‹åˆ†æè¡¨](https://www.jianshu.com/p/feb295459835)
- [[çŸ¥ä¹] è¯­æ³•åˆ†æ | LL(1) åˆ†æç®—æ³•](https://zhuanlan.zhihu.com/p/31301086)
- [[åšå®¢å›­] ã€Šç¼–è¯‘åŸç†ã€‹æ„é€  LL(1) åˆ†æè¡¨çš„æ­¥éª¤ - ä¾‹é¢˜è§£æ](https://www.cnblogs.com/xpwi/p/11065006.html)
